# Концептуальная модель цифрового рубля
---

## 1. Сущности

### 1.1 Client  
**Описание:** представляет физическое или юридическое лицо — держателя цифрового кошелька и/или банковских счетов.  
**Атрибуты:**
- `clientId: UUID` — уникальный идентификатор клиента.  
- `type: String` (`PERSON` | `ORG`) — категория клиента: физлицо или организация.  
- `kycStatus: String` (`VERIFIED` | `UNVERIFIED`) — статус прохождения KYC.  
- `isBlocked: Boolean` — признак блокировки по внутренним или регуляторным требованиям.  

---

### 1.2 BankAccount  
**Описание:** счёт клиента в классической банковской системе (безналичные рубли).  
**Атрибуты:**
- `accountId: UUID` — уникальный идентификатор счёта.  
- `clientId: UUID` — ссылка на владельца (Client).  
- `accountNumber: String` — номер счёта.  
- `balance: Decimal` — текущий остаток в рублях.  
- `status: String` (`ACTIVE` | `CLOSED`) — состояние счёта.  

---

### 1.3 DigitalWallet  
**Описание:** «онлайн-кошелёк» клиента для хранения цифрового рубля на платформе Банка России.  
**Атрибуты:**
- `walletId: UUID` — уникальный идентификатор кошелька.  
- `clientId: UUID` — ссылка на владельца (Client).  
- `balance: Decimal` — текущий баланс цифровых рублей.  
- `offlineLimit: Decimal` — максимальная сумма, доступная для офлайн-транзакций.  
- `status: String` (`ACTIVE` | `FROZEN`) — состояние кошелька.  

---

### 1.4 Instruction  
**Описание:** бизнес-команда от клиента на проведение одной из операций с цифровым рублём.  
**Атрибуты:**
- `instructionId: UUID` — уникальный идентификатор инструкции.  
- `clientId: UUID` — инициатор (Client).  
- `type: String` (`DEPOSIT` | `WITHDRAW` | `TRANSFER`) — тип операции:  
  - **DEPOSIT** — конверсия безналичных рублей в цифровые;  
  - **WITHDRAW** — обратная конверсия (погашение цифровых рублей в пользу банковского счёта);  
  - **TRANSFER** — перевод цифровых рублей между кошельками.  
- `amount: Decimal` — сумма операции.  
- `status: String` (`NEW` | `SENT` | `CONFIRMED` | `ERROR`) — этап исполнения.  
- `createdAt: DateTime` — время создания инструкции.  

---

### 1.5 CBDCTransaction  
**Описание:** запись о транзакции цифрового рубля в реестре ЦБ как результат исполнения соответствующей инструкции.  
**Атрибуты:**
- `txId: UUID` — уникальный идентификатор транзакции ЦБ.  
- `instructionId: UUID` — ссылка на родительскую инструкцию.  
- `timestamp: DateTime` — время исполнения в системе ЦБ.  
- `type: String` (`MINT` | `BURN` | `TRANSFER`) — вид транзакции:  
  - **MINT** — эмиссия цифровых рублей (эквивалент списанию с банковского счёта при DEPOSIT);  
  - **BURN** — погашение цифровых рублей (эквивалент зачислению на банковский счёт при WITHDRAW);  
  - **TRANSFER** — перевод между кошельками.  
- `amount: Decimal` — сумма транзакции.  
- `fromWalletId: UUID \| null` — идентификатор исходного кошелька (null для MINT).  
- `toWalletId: UUID \| null` — идентификатор целевого кошелька (null для BURN).  
- `status: String` (`PENDING` | `SUCCESS` | `FAILED`) — финальный результат в реестре ЦБ.  

---

### 1.6 AutoPayment  
**Описание:** шаблон регулярного перевода цифровых рублей по расписанию.  
**Атрибуты:**
- `autoPaymentId: UUID` — уникальный идентификатор автоплатежа.  
- `clientId: UUID` — владелец автоплатежа (Client).  
- `targetWalletId: UUID` — кошелёк получателя.  
- `amount: Decimal` — сумма перевода.  
- `schedule: String` (`ONCE` | `DAILY` | `MONTHLY`) — периодичность.  

---

## 2. Взаимосвязи сущностей

| Источник              | Назначение             | Кардинальность | Комментарий                                      |
|-----------------------|------------------------|----------------|--------------------------------------------------|
| **Client**            | holds → **BankAccount**| 1 → 0..*       | клиент может иметь несколько банковских счетов   |
| **Client**            | owns → **DigitalWallet**| 1 → 1         | у каждого клиента ровно один цифровой кошелек    |
| **Client**            | sets → **AutoPayment** | 1 → 0..*       | клиент может создать несколько автоплатежей      |
| **DigitalWallet**     | participates → **CBDCTransaction** | 1 → 0..* | кошелек участвует во многих транзакциях         |
| **Instruction**       | based on → **CBDCTransaction** | 1 → 0..* | инструкция порождает одну или несколько транзакций (обычно одну) |

---

## 3. Удовлетворение кейсов заказчика

1. **Оплата товаров и услуг**  
   - перевод между кошельками:  
     `Instruction(type=TRANSFER)` → `CBDCTransaction(type=TRANSFER)`.  
2. **Дефицит средств в кошельке**  
   - авто-/ручной `DEPOSIT`:  
     сначала списание с `BankAccount`, затем `Instruction(type=DEPOSIT)` → `CBDCTransaction(type=MINT)`.  
3. **Автопереводы**  
   - `AutoPayment` по расписанию формирует `Instruction(type=TRANSFER)`.  
4. **Офлайн-режим**  
   - ограничен полем `DigitalWallet.offlineLimit`.  
5. **ПОД/ФТ/ФРОМУ**  
   - контроль через `Client.kycStatus` и `Client.isBlocked`; все операции логируются в `CBDCTransaction`.  
6. **Интеграция с платформой ЦБ**  
   - отражена в сущности `CBDCTransaction` и связи с `Instruction`.  

---

> Дальнейшие этапы разработки: на базе этой концептуальной модели будут построены **логическая модель** (описание потоков данных, правил, бизнес-процессов) и **физическая модель** (DDL-скрипты, XML-примеры, схемы хранилищ).
